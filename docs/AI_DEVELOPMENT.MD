Káº¿ hoáº¡ch phÃ¡t triá»ƒn Core AI - ErgoGuard (Lean MVP)

Táº­p trung vÃ o giáº£i phÃ¡p: PhÃ¢n tÃ­ch 1 táº¥m áº£nh - Tráº£ vá» káº¿t quáº£ phÃ¢n tÃ­ch theo gÃ³c chá»¥p (NghiÃªng/Trá»±c diá»‡n) - ÄÆ°a ra hÃ nh Ä‘á»™ng kháº¯c phá»¥c.

1. Kiáº¿n trÃºc luá»“ng dá»¯ liá»‡u (MVP Pipeline)

Dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c xá»­ lÃ½ linh hoáº¡t tÃ¹y theo gÃ³c chá»¥p ngÆ°á»i dÃ¹ng lá»±a chá»n:

Input (Native UI): User chá»n cháº¿ Ä‘á»™ chá»¥p/upload: GÃ³c nghiÃªng (Side View) hoáº·c Trá»±c diá»‡n (Front View).

MLKit Pose Detection (Native SDK): Cháº¡y 1 láº§n trÃªn áº£nh Ä‘á»ƒ láº¥y tá»a Ä‘á»™ Landmarks.

Data Mapper (Native): Chuyá»ƒn Ä‘á»•i Landmarks sang PosturePose object cá»§a Kotlin Shared.

Quality Check (Shared Module): \* GÃ³c nghiÃªng: Kiá»ƒm tra 1 Tai & 1 Vai (phÃ­a gáº§n camera nháº¥t).

Trá»±c diá»‡n: Kiá»ƒm tra Ä‘á»§ 2 Tai & 2 Vai.

Brain Logic (Shared Module): \* Náº¿u lÃ  GÃ³c nghiÃªng: TÃ­nh tá»· lá»‡ nhÃ´ Ä‘áº§u ($X\%$).

Náº¿u lÃ  Trá»±c diá»‡n: TÃ­nh Ä‘á»™ lá»‡ch vai ($\Delta Y$ shoulders) vÃ  Ä‘á»™ nghiÃªng Ä‘áº§u ($\Delta Y$ ears).

PhÃ¢n loáº¡i má»©c Ä‘á»™ dá»±a trÃªn quy táº¯c Kapandji (NghiÃªng) vÃ  tá»· lá»‡ Ä‘á»‘i xá»©ng (Trá»±c diá»‡n).

Comparison: So sÃ¡nh káº¿t quáº£ Ä‘á»ƒ hiá»ƒn thá»‹ má»©c Ä‘á»™ cáº£i thiá»‡n sau khi thá»±c hiá»‡n "The Fix Loop".

2. Chi tiáº¿t xÃ¢y dá»±ng "Bá»™ nÃ£o" (Shared Module)

ThÆ° má»¥c: shared/src/commonMain/kotlin/...

A. Data Models (Báº¥t biáº¿n)

Point(x, y, confidence): Tá»a Ä‘á»™ chuáº©n hÃ³a (0.0 - 1.0).

ViewMode: Enum { SIDE, FRONT }

PosturePose: Chá»©a Ä‘áº§y Ä‘á»§ cÃ¡c Ä‘iá»ƒm Tai (TrÃ¡i/Pháº£i) vÃ  Vai (TrÃ¡i/Pháº£i).

AnalysisResult:

deviationPercent: Double (GiÃ¡ trá»‹ lá»‡ch %).

metrics: Map<String, Double> (Lá»‡ch vai, NghiÃªng Ä‘áº§u, NhÃ´ cá»•).

level: Enum (NORMAL, WARNING, DANGER).

message: Slogan vÃ  giáº£i thÃ­ch y khoa dá»±a trÃªn gÃ³c chá»¥p.

fixAction: HÆ°á»›ng dáº«n bÃ i táº­p kháº¯c phá»¥c nhanh (Chin Tuck hoáº·c Shoulder Roll).

B. PostureAnalyzer (Xá»­ lÃ½ toÃ¡n há»c Ä‘a cháº¿ Ä‘á»™)

Cháº¿ Ä‘á»™ GÃ³c nghiÃªng (Side View):

$\Delta x = |x_{ear} - x_{shoulder}|$

$L = |y_{ear} - y_{shoulder}|$ (Äá»™ cao cá»•).

$X\% = (\Delta x / L) \times 100$.

Cháº¿ Ä‘á»™ Trá»±c diá»‡n (Front View):

Lá»‡ch vai: $\Delta Y_{shoulder} = |y_{L\_shoulder} - y_{R\_shoulder}|$.

NghiÃªng Ä‘áº§u: $\Delta Y_{head} = |y_{L\_ear} - y_{R\_ear}|$.

Quy Ä‘á»•i %: $\Delta Y / \text{Chiá»u rá»™ng vai}$ (Äáº£m báº£o khÃ´ng phá»¥ thuá»™c khoáº£ng cÃ¡ch camera).

C. Logic phÃ¢n loáº¡i (Thresholds)

GÃ³c nghiÃªng: NgÆ°á»¡ng 15% - 30% (Quy táº¯c Kapandji).

Trá»±c diá»‡n: \* Lá»‡ch vai > 3% tá»· lá»‡ vai: WARNING.

NghiÃªng Ä‘áº§u > 5 Ä‘á»™: WARNING.

3. PhÃ¡t triá»ƒn "ÄÃ´i máº¯t" (Native Side)

Android (Kotlin + CameraX)

UI chá»n gÃ³c chá»¥p: Cung cáº¥p khung (Overlay) hÆ°á»›ng dáº«n ngÆ°á»i dÃ¹ng cÄƒn chá»‰nh vai vÃ  Ä‘áº§u.

Mapping chÃ­nh xÃ¡c 4 Ä‘iá»ƒm má»‘c sang Shared Module.

iOS (SwiftUI + AVFoundation)

Sá»­ dá»¥ng UIImagePicker hoáº·c Custom Camera View.

Äáº£m báº£o xá»­ lÃ½ Ä‘Ãºng hÆ°á»›ng áº£nh (Orientation) trÆ°á»›c khi gá»­i tá»a Ä‘á»™ sang Kotlin.

4. Chiáº¿n lÆ°á»£c Unit Test

Test Case 1 (GÃ³c nghiÃªng): Kiá»ƒm tra Ä‘á»™ nhÃ´ Ä‘áº§u theo tá»· lá»‡ $\Delta x / L$.

Test Case 2 (Trá»±c diá»‡n - Chuáº©n): Vai vÃ  tai cÃ¢n báº±ng tuyá»‡t Ä‘á»‘i -> NORMAL.

Test Case 3 (Trá»±c diá»‡n - Lá»‡ch): Vai trÃ¡i tháº¥p hÆ¡n vai pháº£i 10% -> WARNING (Shoulder Imbalance).

Test Case 4 (Quality Check): Thiáº¿u Ä‘iá»ƒm má»‘c cáº§n thiáº¿t cho tá»«ng cháº¿ Ä‘á»™ -> Tráº£ vá» lá»—i hÆ°á»›ng dáº«n chá»¥p láº¡i.

ğŸ›  Check-list triá»ƒn khai MVP

[ ] Má»Ÿ rá»™ng PosturePose Ä‘á»ƒ chá»©a Ä‘á»§ cÃ¡c Ä‘iá»ƒm má»‘c 2 bÃªn.

[ ] Viáº¿t hÃ m toÃ¡n há»c cho calculateFrontalImbalance (Lá»‡ch vai/Ä‘áº§u).

[ ] TÃ­ch há»£p ViewMode vÃ o PostureAnalyzer Ä‘á»ƒ tá»± Ä‘á»™ng chá»n logic xá»­ lÃ½.

[ ] Viáº¿t Unit Test cho cáº£ 2 cháº¿ Ä‘á»™ chá»¥p.

[ ] Cáº­p nháº­t UI á»Ÿ cáº£ 2 ná»n táº£ng Ä‘á»ƒ há»— trá»£ chá»n gÃ³c chá»¥p vÃ  hiá»ƒn thá»‹ káº¿t quáº£ tÆ°Æ¡ng á»©ng.
