# ErgoGuard - Changelog & Implementation Summary

## ğŸ“‹ Tá»•ng quan

ErgoGuard lÃ  á»©ng dá»¥ng phÃ¢n tÃ­ch tÆ° tháº¿ sá»­ dá»¥ng AI (MLKit Pose Detection) Ä‘á»ƒ giÃºp ngÆ°á»i dÃ¹ng nháº­n biáº¿t vÃ  cáº£i thiá»‡n tÆ° tháº¿, Ä‘áº·c biá»‡t lÃ  váº¥n Ä‘á» "Cá»• rÃ¹a" (Forward Head Posture).

---

## ğŸš€ Phase 1: MVP Lean (Shared Module)

### Má»¥c tiÃªu

XÃ¢y dá»±ng "Bá»™ nÃ£o" core logic trong Kotlin Multiplatform Shared Module.

### Files Ä‘Ã£ táº¡o

#### Models (`shared/src/commonMain/.../model/`)

| File                  | MÃ´ táº£                                             |
| --------------------- | ------------------------------------------------- |
| `Point.kt`            | Model tá»a Ä‘á»™ vá»›i confidence                       |
| `PosturePose.kt`      | Chá»©a 4 Ä‘iá»ƒm má»‘c (2 ears + 2 shoulders)            |
| `ViewMode.kt`         | Enum: SIDE, FRONT                                 |
| `SeverityLevel.kt`    | Enum: NORMAL, WARNING, DANGER vá»›i ngÆ°á»¡ng Kapandji |
| `AnalysisResult.kt`   | Káº¿t quáº£ phÃ¢n tÃ­ch vá»›i viewMode vÃ  metrics         |
| `ComparisonResult.kt` | So sÃ¡nh cáº£i thiá»‡n giá»¯a 2 láº§n chá»¥p                 |

#### Analyzers (`shared/src/commonMain/.../analyzer/`)

| File                    | MÃ´ táº£                                     |
| ----------------------- | ----------------------------------------- |
| `ProtrusionAnalyzer.kt` | TÃ­nh % nhÃ´ cá»• (Side View)                 |
| `FrontalAnalyzer.kt`    | TÃ­nh % lá»‡ch vai, nghiÃªng Ä‘áº§u (Front View) |
| `PostureAnalyzer.kt`    | Facade router theo ViewMode               |
| `QualityChecker.kt`     | Kiá»ƒm tra cháº¥t lÆ°á»£ng áº£nh Ä‘a cháº¿ Ä‘á»™         |
| `ComparisonEngine.kt`   | So sÃ¡nh káº¿t quáº£ "The Fix Loop"            |

#### Utilities (`shared/src/commonMain/.../util/`)

| File            | MÃ´ táº£                      |
| --------------- | -------------------------- |
| `AppStrings.kt` | Static strings vÃ  messages |

---

## ğŸ“¸ Phase 2: Android Camera & MLKit

### Má»¥c tiÃªu

TÃ­ch há»£p CameraX vÃ  MLKit Pose Detection trÃªn Android.

### Files Ä‘Ã£ táº¡o (`composeApp/src/androidMain/`)

#### Camera (`camera/`)

| File                     | MÃ´ táº£                                            |
| ------------------------ | ------------------------------------------------ |
| `CameraManager.kt`       | Quáº£n lÃ½ CameraX: preview, capture, switch camera |
| `PoseDetectorManager.kt` | Wrapper MLKit Pose Detection                     |

#### Mapper (`mapper/`)

| File            | MÃ´ táº£                                 |
| --------------- | ------------------------------------- |
| `PoseMapper.kt` | Map MLKit Pose â†’ PosturePose (4 Ä‘iá»ƒm) |

#### ViewModel (`viewmodel/`)

| File                  | MÃ´ táº£                                                 |
| --------------------- | ----------------------------------------------------- |
| `PostureViewModel.kt` | State management, selectedViewMode, analysis pipeline |

#### Dependencies thÃªm vÃ o

```toml
# CameraX
camerax = "1.4.2"

# MLKit Pose Detection
mlkit-pose = "18.0.0-beta5"

# DataStore
datastore = "1.1.1"
```

---

## âœ¨ Phase 3: Polish & UX

### Má»¥c tiÃªu

HoÃ n thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

### Features Ä‘Ã£ triá»ƒn khai

#### 1. Timer Selfie â±ï¸

- Chá»n timer: 0s / 3s / 5s / 10s
- Countdown overlay lá»›n á»Ÿ giá»¯a mÃ n hÃ¬nh
- Auto capture khi háº¿t thá»i gian

#### 2. Gallery Import ğŸ–¼ï¸

- Photo Picker API tÃ­ch há»£p
- PhÃ¢n tÃ­ch áº£nh tá»« thÆ° viá»‡n

#### 3. Multi-View Support ğŸ“

- **Side View**: PhÃ¢n tÃ­ch % nhÃ´ cá»• (quy táº¯c Kapandji)
- **Front View**: PhÃ¢n tÃ­ch % lá»‡ch vai, nghiÃªng Ä‘áº§u
- ViewMode selector chips á»Ÿ Ä‘áº§u CameraScreen

#### 4. Onboarding ğŸ“±

- 3 slides hÆ°á»›ng dáº«n sá»­ dá»¥ng
- LÆ°u flag `hasSeenOnboarding` vÃ o DataStore

#### 5. History ğŸ“Š

- LÆ°u lá»‹ch sá»­ phÃ¢n tÃ­ch vÃ o DataStore
- HistoryScreen vá»›i LazyColumn vÃ  HistoryCard

#### 6. UI Polish ğŸ¨

- Material Icons tá»‘i giáº£n (giá»‘ng Google Pixel Camera)
- TÃ¡ch `NoPermissionScreen` component riÃªng
- Bottom controls: Gallery - Shutter - Timer - Flip Camera
- Gradient overlays, guide frame vá»›i text Ä‘á»™ng

### UI Files (`ui/`)

| File                    | MÃ´ táº£                                      |
| ----------------------- | ------------------------------------------ |
| `CameraScreen.kt`       | Camera preview, timer, gallery, multi-view |
| `NoPermissionScreen.kt` | MÃ n hÃ¬nh yÃªu cáº§u quyá»n camera              |
| `ResultScreen.kt`       | Hiá»ƒn thá»‹ káº¿t quáº£ phÃ¢n tÃ­ch                 |
| `HistoryScreen.kt`      | Danh sÃ¡ch lá»‹ch sá»­ vá»›i Material Icons       |
| `OnboardingScreen.kt`   | 3 slides hÆ°á»›ng dáº«n                         |

### Data (`data/`)

| File                          | MÃ´ táº£                                      |
| ----------------------------- | ------------------------------------------ |
| `AppPreferencesRepository.kt` | DataStore preferences + HistoryEntry model |

---

## ğŸ¨ Phase 4: UI Refactoring & Material Design 3

### Má»¥c tiÃªu

Chuyá»ƒn Ä‘á»•i giao diá»‡n sang Native Android Material Design 3 (M3) chuáº©n vÃ  tá»‘i Æ°u hÃ³a tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

### CÃ¡c thay Ä‘á»•i chÃ­nh

#### 1. Design System
- **Theme**: Chuyá»ƒn tá»« Glassmorphism sang M3 Baseline (Cyan & Emerald)
- **Color**: Há»— trá»£ Ä‘áº§y Ä‘á»§ Light/Dark mode vá»›i dynamic colors
- **Typography**: Sá»­ dá»¥ng font máº·c Ä‘á»‹nh há»‡ thá»‘ng (Roboto) thay vÃ¬ custom fonts
- **Elevation**: ThÃªm shadows chuáº©n M3 cho cÃ¡c Card components

#### 2. Layout Improvements
- **Camera Screen**:
  - Re-layout top controls: Switch Camera + View Mode + History náº±m trÃªn cÃ¹ng má»™t hÃ ng
  - Fix lá»—i hiá»ƒn thá»‹ Safe Area (Edge-to-edge): Camera preview trÃ n viá»n dÆ°á»›i status bar vÃ  navigation bar
  - Tá»‘i Æ°u hÃ³a gradient overlays Ä‘á»ƒ dá»… Ä‘á»c text hÆ¡n
  - **Timer UI**: Chuyá»ƒn Ä‘á»•i Timer Picker thÃ nh dáº¡ng floating/inline bubble bÃªn cáº¡nh nÃºt Timer thay vÃ¬ overlay riÃªng biá»‡t.
- **History Screen**:
  - Thay tháº¿ icon "â†" text báº±ng icon `ArrowBack` chuáº©n Material
  - Cáº£i thiá»‡n hiá»ƒn thá»‹ Card lá»‹ch sá»­ vá»›i shadow vÃ  elevation
- **Components**:
  - Chuáº©n hÃ³a cÃ¡c nÃºt báº¥m (Button, IconButton, OutlinedButton)
  - Card sá»­ dá»¥ng `secondaryContainer` vÃ  `surfaceVariant` Ä‘Ãºng chuáº©n M3

---

## ğŸ Phase 5: iOS Implementation & Feature Parity

### Má»¥c tiÃªu

XÃ¢y dá»±ng phiÃªn báº£n iOS Native vá»›i SwiftUI, Ä‘áº£m báº£o tÃ­nh nÄƒng tÆ°Æ¡ng Ä‘Æ°Æ¡ng (Feature Parity) vá»›i Android vÃ  giao diá»‡n chuáº©n iOS Premium (Liquid Glass).

### Features Ä‘Ã£ triá»ƒn khai

#### 1. Liquid Glass Design System ğŸ’
- **Effect**: Sá»­ dá»¥ng native `ultraThinMaterial` vÃ  `LinearGradient` Ä‘á»ƒ táº¡o hiá»‡u á»©ng kÃ­nh má» cao cáº¥p.
- **Components**: `LiquidGlassCard`, `GlassButton`, `GlassChip`, `GlassIconButton`.
- **Animations**: Hiá»‡u á»©ng chuyá»ƒn Ä‘á»™ng mÆ°á»£t mÃ , scale button khi nháº¥n.

#### 2. Native SwiftUI Screens
- **CameraScreen**: Giao diá»‡n camera trÃ n viá»n, timer inline floating, grid hÆ°á»›ng dáº«n.
- **ResultScreen**: Hiá»ƒn thá»‹ káº¿t quáº£ phÃ¢n tÃ­ch, so sÃ¡nh vá»›i láº§n trÆ°á»›c, vÃ  bÃ i táº­p cáº£i thiá»‡n.
- **HistoryScreen**: Danh sÃ¡ch lá»‹ch sá»­ phÃ¢n tÃ­ch vá»›i chá»‰ sá»‘ severity color-coded.
- **OnboardingScreen**: Pager giá»›i thiá»‡u tÃ­nh nÄƒng.
- **NoPermissionScreen**: Xá»­ lÃ½ quyá»n truy cáº­p Camera duyÃªn dÃ¡ng.

#### 3. Localization (Äa ngÃ´n ngá»¯) ğŸŒ
- Há»— trá»£ Ä‘áº§y Ä‘á»§ **Tiáº¿ng Anh (en)** vÃ  **Tiáº¿ng Viá»‡t (vi)**.
- File ngÃ´n ngá»¯: `Localizable.strings`.

#### 4. Architecture & Structure (`iosApp/iosApp/UI/`)
- **Screens**: Chá»©a cÃ¡c mÃ n hÃ¬nh chÃ­nh.
- **Components**: CÃ¡c UI components tÃ¡i sá»­ dá»¥ng (Glass).
- **Theme**: `Colors.swift` define báº£ng mÃ u Ä‘á»“ng bá»™ vá»›i Android (Cyan & Emerald).
- **Models**: Structs dá»¯ liá»‡u dÃ¹ng chung (`AnalysisResult`, `HistoryEntry`).

---

## ğŸ“ Cáº¥u trÃºc Project (Updated)

```
ErgoGuard/
â”œâ”€â”€ shared/src/commonMain/kotlin/.../ (Core Logic)
â”‚
â”œâ”€â”€ composeApp/src/androidMain/kotlin/.../ (Android App)
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ CameraScreen.kt (Updated with inline timer)
â”‚   â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ iosApp/iosApp/ (iOS App)
â”‚   â”œâ”€â”€ UI/
â”‚   â”‚   â”œâ”€â”€ Screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ MainContentView.swift (App Entry & Navigation)
â”‚   â”‚   â”‚   â”œâ”€â”€ CameraScreen.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultScreen.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ HistoryScreen.swift
â”‚   â”‚   â”‚   â””â”€â”€ OnboardingScreen.swift
â”‚   â”‚   â”œâ”€â”€ Components/
â”‚   â”‚   â”‚   â””â”€â”€ GlassComponents.swift
â”‚   â”‚   â”œâ”€â”€ Theme/
â”‚   â”‚   â”‚   â”œâ”€â”€ Colors.swift
â”‚   â”‚   â”‚   â””â”€â”€ Extensions.swift
â”‚   â”‚   â””â”€â”€ Models/
â”‚   â”‚       â””â”€â”€ Models.swift
â”‚   â”œâ”€â”€ en.lproj/
â”‚   â”‚   â””â”€â”€ Localizable.strings
â”‚   â””â”€â”€ vi.lproj/
â”‚       â””â”€â”€ Localizable.strings
â”‚
â””â”€â”€ docs/
    â””â”€â”€ CHANGELOG.MD (file nÃ y)
```

---

## ğŸ”¬ CÃ´ng thá»©c toÃ¡n há»c

### Side View (% NhÃ´ cá»•)

$$X\% = \frac{|x_{ear} - x_{shoulder}|}{|y_{ear} - y_{shoulder}|} \times 100$$

### Front View (% Lá»‡ch vai)

$$Y\% = \frac{|y_{left\_shoulder} - y_{right\_shoulder}|}{width_{shoulders}} \times 100$$

### NgÆ°á»¡ng phÃ¢n loáº¡i

| ViewMode         | NORMAL | WARNING | DANGER |
| ---------------- | ------ | ------- | ------ |
| Side             | < 15%  | 15-30%  | > 30%  |
| Front (Shoulder) | < 3%   | 3-8%    | > 8%   |

---

## ğŸ› ï¸ Build & Test

### Android
```bash
./gradlew :composeApp:assembleDebug
```

### iOS
Má»Ÿ `iosApp/iosApp.xcodeproj` báº±ng Xcode 15+ vÃ  cháº¡y trÃªn Simulator/Device.

---

**Cáº­p nháº­t láº§n cuá»‘i**: 2026-01-29
